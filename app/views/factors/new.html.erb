★結果★<br />

小牧市の住所だけ取れたやつ

serachPlaceの初期段階
<div id="results" style="width: 100%; height: 200px; border: 1px dotted; padding: 10px; overflow-y: scroll;"></div>
</div>

<%= link_to '一覧へ戻る', '/factors'%>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDJzux1JhQNtBO-9TNu2fNp2hzzJOcyln8&libraries=places"></script>



<script type="text/javascript">

var content =["小牧市小松寺2丁目52番地","映画館","中華料理","小牧市小松寺2丁目52"]


var count = 0;
var totalname=[]
var totalduration=[]
var totaldistance=[]


var place1 =""
var place2 =""
var place3 =""
var place4 =""

//全体の状況を管理する関数、place4まで代入されたらcreateを実行する
window.onload=function count1(){
  searchPlace("小牧市小松寺2丁目５２番地",function(results,status){
    place1 = results[0].geometry.location.lat()+","+results[0].geometry.location.lng()
    place4= results[0].geometry.location.lat()+","+results[0].geometry.location.lng()
    console.log(place1)

    searchNearby(place1,content[1],function(){

    console.log("searchNearbyが動いているのかのテスト")

    })
  })
}







//二番めの小牧市の住所を元に近くのお店を検索する関数
function searchNearby(latLng,keywordInput,callback){


  document.getElementById("results").innerHTML = "Now Loading...";

  var map = new google.maps.Map(
    document.createElement("div")
  );

  var service = new google.maps.places.PlacesService(map);

  service.nearbySearch(
    {
      location:latLng,
      radius: 5000,
      keyword: keywordInput,
      
    },
    callback
  );
}


//二番めの小牧市の住所を元に近くのお店を検索する関数のコールバック関数
function create2(results,status){
  console.log(status)
  placesList = placesList.concat(results);

  for (var i = 0; i < placesList.length; i++) {
    if(placesList[i].rating == undefined){
      placesList[i].rating = -1;
    }
  }

  placesList.sort(function(a,b){
    if(a.rating > b.rating) return -1;
    if(a.rating < b.rating) return 1;
    return 0;
  });


  var place = placesList[0];

  var lat=place.geometry.location.lat()
  var lng=place.geometry.location.lng()

  place2==place.geometry.location.lat()+","+place.geometry.location.lng()
  count++
  checkFinish();
  console.log(place2)


}


//始めの小牧市の住所を取得するための関数
function searchPlace(addressInput, callback){
var geocoder = new google.maps.Geocoder();
geocoder.geocode({address:addressInput}, callback);
}





</script>